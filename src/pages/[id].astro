---
import { getCollection } from "astro:content";
import Work from "../components/Work.astro";
import Talk from "../components/Talk.astro";
import Layout from "../layouts/Layout.astro";

// 1. Generate paths for both series and slides collections
export async function getStaticPaths() {
    const seriesEntries = await getCollection("works");
    const slidesEntries = await getCollection("talks");

    // Map series entries (leave as-is, flat YAML files)
    const seriesPaths = seriesEntries.map((entry) => ({
        params: { id: entry.id },
        props: { entry, type: "works" },
    }));

    // Map slides entries (use only slug/folder for [id], preserve full entry.id for props)
    const slidesPaths = slidesEntries.map((entry) => {
        const slug = entry.id.split("/")[0];
        return {
            params: { id: slug },
            props: { entry, type: "talks" },
        };
    });

    // Combine both collections
    return [...seriesPaths, ...slidesPaths];
}

// 2. Get the entry and its type from props
const { entry, type } = Astro.props;
// const { post } = Astro.props;
const id: string = entry.id.split("/").pop() ?? "";
---

<Layout pageType={type}>
    {type === "works" ? <Work {entry} /> : <Talk {entry} />}
</Layout>
